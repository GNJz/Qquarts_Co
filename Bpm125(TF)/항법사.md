flowchart TB

%% =======================
%% AI 항법사: 한눈에 보는 전체 구조
%% 복붙 → GitHub README에서 바로 미리보기 가능
%% =======================

subgraph Q[Quarkka Vehicle (R2-D2처럼 우주선의 몸체)]
  Sns[**Sensors**\nIMU · Star-tracker · LiDAR/Cam · Pressure · GPS]
  Act[**Actuators**\nThrusters · RCS · Reaction Wheels · Control Surfaces]
end

subgraph GNC[GNC Loop (Guidance–Navigation–Control)]
  Nav[**Navigation**\nState Estimation (UKF/Particle)]
  Gui[**Guidance**\nTrajectory/MPC · Waypointing]
  Ctrl[**Control**\nLQR/MPC/PID]
  Nav --> Gui --> Ctrl
end

subgraph AI_BRAIN[cookiie AI Brain (멘타트 + R2-D2의 두뇌)]
  WMdl[**World Model**\nSNN/RNN + Embeddings]
  Plan[**Planner**\nLLM + MCTS/MPC]
  Pol[**Policy**\nRL/IL]
  Anom[**Anomaly & Hazard**\nLyapunov λ · OOD · Health]
  Mem[**Memory**\nLogs · Maps · Episodes]
  WMdl --> Plan --> Pol
  Anom -->|risk signals| Plan
  Mem  --> Plan
  Plan -->|goals & constraints| Gui
end

subgraph DTG_KNOB[DTG Safety Knob (위험 온도조절 노브)]
  Metrics[**Metrics**\nEnergy Drift · Lyapunov λ · Fuel/Temp Margins]
  Mode[**Mode**\nNominal ▸ Cautious ▸ Abort]
  Constr[**Constraints**\nThrust Cap · Step Size · Keep-out Zones · Noise Budget]
  Metrics --> Mode --> Constr
end

subgraph TWIN[Digital Twin (예측 시뮬레이터)]
  Sim[**N/3-Body + Navier–Stokes(ν)**\nOrbit · Atmos · Contact/Plume]
end

subgraph NET[Flarania Network (협력/중계)]
  Swarm[**Peer AIs / Relay / Map Fusion**]
end

Ground[**Ground Ops / Teleop**]
Tlm[**Telemetry & Logs**]

%% -------- 데이터 흐름 --------
Sns --> Nav
Ctrl --> Act
Act -. mechanical/flight response .-> Sns

%% AI 연결
Sns --> WMdl
Nav --> WMdl
TWIN --> WMdl
Plan --> Gui
DTG_KNOB --> Ctrl
Constr -. safety limits .-> Ctrl
Mode -. policy bias .-> Pol
GNC --> Tlm
Tlm --> Ground
Ground <---> NET
NET <-- data/updates --> AI_BRAIN

%% 쌍방향 예측/제약
Gui --> TWIN
TWIN --> Metrics

%% 패키지 간 상위 의도/명령
AI_BRAIN -->|high-level intent| GNC

%% -------- 스타일 --------
classDef box fill:#eef,stroke:#335,stroke-width:1px,rx:8,ry:8
classDef brain fill:#eefeef,stroke:#2b6,stroke-width:1px,rx:8,ry:8
classDef safety fill:#fff0f0,stroke:#b44,stroke-width:1px,rx:8,ry:8
classDef io fill:#f7f7ff,stroke:#556,stroke-width:1px,rx:8,ry:8

class Q,GNC,TWIN,NET,Ground,Tlm box
class AI_BRAIN brain
class DTG_KNOB safety
class Sns,Act,Nav,Gui,Ctrl,WMdl,Plan,Pol,Anom,Mem,Metrics,Mode,Constr,Sim,Swarm io

%% -------- 간단 레전드 --------
%% Sensors→Navigation→Guidance→Control→Actuators 가 기본 비행 루프
%% Digital Twin 은 앞으로의 위험(λ·에너지 드리프트)을 예측해 DTG가 제약을 조정
%% cookiie AI 는 목표/제약을 생성·업데이트(멘타트처럼 사고, R2-D2처럼 즉응)
